<!DOCTYPE html>
<html lang="en">

<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Open Source PCE :: Project Info</title>
<meta name="description" content="" />
<meta name="generator" content="concrete5 - 5.6.1.2" />
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<!-- Site Header Content //-->

<link rel="stylesheet" href="./css/reset.css" />
<script src="./js/cytoscape.js"></script>

</head>

<body>

	<!--start main container -->

	<div id="main-container" class="container_24">

		<div id="header">


			<h1>
				<a title="Home" href="/">Open Source PCE</a>
			</h1>
			<ul class="nav">
				<li class=""><a href="/" target="_self" class="">Home</a></li>
				<li class=""><a href="/index.php/project-info/" target="_self"
					class="">Project Info</a></li>
				<li class="nav-selected nav-path-selected"><a
					href="./topology.html" target="_self"
					class="nav-selected nav-path-selected">Topology</a></li>
			</ul>
			<div id="header-image"></div>

		</div>

		<div class="clear"></div>

		<div class="clear"></div>


		<div id="main-content-container" class="grid_16">
			<div id="main-content-inner">

				<div id="cy"></div>

			</div>

		</div>

		<!-- end main content columns -->

		<div class="clear"></div>

		<div id="footer">

			<div id="footer-inner">

				<div class="clear"></div>
				<p class="footer-copyright">&copy;2013 Open Source PCE.</p>
				<!--<p class="footer-tag-line">Built with <a href="http://www.concrete5.org/" alt="Free Content Management System" target="_blank">concrete5 - an open source CMS</a></p>-->

			</div>

		</div>

		<!-- end main container -->

	</div>

				<script type="text/javascript">
		$('#cy').cytoscape({
		style: cytoscape.stylesheet()
		    .selector('node')
		      .css({
		        'content': 'data(name)',
		        'text-valign': 'center',
		        'color': 'white',
		        'text-outline-width': 2,
		        'text-outline-color': '#888'
		      })
		    .selector('edge')
		      .css({
		        'target-arrow-shape': 'triangle'
		      })
		    .selector(':selected')
		      .css({
		        'background-color': 'black',
		        'line-color': 'black',
		        'target-arrow-color': 'black',
		        'source-arrow-color': 'black'
		      })
		    .selector('.faded')
		      .css({
		        'opacity': 0.25,
		        'text-opacity': 0
		      }),
		  			  
		  ready: function(){
		    window.cy = this;
		    
		    // giddy up...
		    
		    //document.getElementById("footer-inner").innerHTML = elements.nodes;
				var url = "http://localhost:8080/rest/topology";
				var client = new XMLHttpRequest();
				client.open("GET", url, false);
				client.setRequestHeader("Content-Type", "text/plain");
				client.send();
				var graph=[];
				if (client.status == 200) {			    
				    var out = client.responseText;
				    graph = eval("(" + out + ")");
//		    		document.getElementById("header-image").innerHTML="<p>" + out+ "</p>";
//					alert("The request did succeed!\n\nThe response status was: " + client.status + " " + client.statusText + ".");
//					alert("Graph Parsing: " + graph.nodes[0].data.id + "");
				}else
				    alert("The request did not succeed!\n\nThe response status was: " + client.status + " " + client.statusText + ".");

				
		    	for (var i=0, len = graph.nodes.length; i<len; i++) {
		    		var eles = {};
		    		eles.group="nodes";
		    		eles.data={};
		    		eles.data.id=graph.nodes[i].data.id;
		    		eles.data.name=graph.nodes[i].data.name;
		    		eles.position = [];
		    		eles.position.x = graph.nodes[i].position.x;
		    		eles.position.y = graph.nodes[i].position.y;
		    		console.log (eles.data.id);
		    		cy.add (eles);
//		    		var n0 = cy.node(graph.nodes[i].data.id);
		    //		console.log (f.data.id);
		    	}
		    
		    	for (var i=0, len = graph.edges.length; i<len; i++) {		    		
		    		var f={};
		    		f.group="edges";		    		
		    		f.data={};
		    		f.data.source = graph.edges[i].data.source;
		    		f.data.target = graph.edges[i].data.target;
		    		cy.add (f);
		    		console.log(f.data.source + "-" + f.data.target);
		    	}
		    

		    	
		    	
/* var eles = cy.add([
  { group: "nodes", data: { id: "n0" }, position: { x: 100, y: 100 } },
  { group: "nodes", data: { id: "n1" }, position: { x: 200, y: 200 } },
  { group: "edges", data: { id: "e0", source: "n0", target: "n1" } }
]);
 */		    
//		    console.log(cy.elements());
//		    cy.elements().unselectify();


		    
		    cy.on('tap', 'node', function(e){
		      var node = e.cyTarget; 
		      var neighborhood = node.neighborhood().add(node);
		      
		      cy.elements().addClass('faded');
		      neighborhood.removeClass('faded');
		    });
		    
		    cy.on('tap', function(e){
		      if( e.cyTarget === cy ){
		        cy.elements().removeClass('faded');
		      }
		    });
		  }
		});
</script>





</body>
</html>
